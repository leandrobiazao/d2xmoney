<div class="fii-catalog">
    <div class="catalog-header">
        <h3>Catálogo de Fundos Imobiliários</h3>
        <div class="header-actions">
            <p class="catalog-count">{{ filteredFIIs.length }} FIIs disponíveis</p>
            <button class="btn-add-fii" (click)="showNewFIIDialog()">+ Adicionar Novo FII</button>
        </div>
    </div>

    @if (showNewFIIForm) {
    <div class="new-fii-form-container">
        <div class="new-fii-form">
            <div class="form-header">
                <h4>Adicionar Novo Fundo Imobiliário</h4>
                <button class="btn-close" (click)="cancelNewFII()">×</button>
            </div>
            
            @if (errorMessage) {
            <div class="message error">{{ errorMessage }}</div>
            }
            
            @if (successMessage) {
            <div class="message success">{{ successMessage }}</div>
            }
            
            <form (ngSubmit)="createNewFII()">
                <div class="form-row">
                    <div class="form-group required">
                        <label for="ticker">Ticker *</label>
                        <input 
                            type="text" 
                            id="ticker" 
                            [(ngModel)]="newFII.ticker" 
                            name="ticker"
                            placeholder="Ex: HGLG11" 
                            required
                            maxlength="10"
                            [disabled]="isCreating"
                        />
                    </div>
                    
                    <div class="form-group required">
                        <label for="name">Nome *</label>
                        <input 
                            type="text" 
                            id="name" 
                            [(ngModel)]="newFII.name" 
                            name="name"
                            placeholder="Nome do Fundo" 
                            required
                            [disabled]="isCreating"
                        />
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="segment">Segmento</label>
                        <input 
                            type="text" 
                            id="segment" 
                            [(ngModel)]="newFII.segment" 
                            name="segment"
                            placeholder="Ex: Tijolo:Shoppings" 
                            [disabled]="isCreating"
                        />
                    </div>
                    
                    <div class="form-group">
                        <label for="target_audience">Público Alvo</label>
                        <input 
                            type="text" 
                            id="target_audience" 
                            [(ngModel)]="newFII.target_audience" 
                            name="target_audience"
                            placeholder="Ex: Investidor Qualificado" 
                            [disabled]="isCreating"
                        />
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group full-width">
                        <label for="administrator">Administrador</label>
                        <input 
                            type="text" 
                            id="administrator" 
                            [(ngModel)]="newFII.administrator" 
                            name="administrator"
                            placeholder="Nome do Administrador" 
                            [disabled]="isCreating"
                        />
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-cancel" (click)="cancelNewFII()" [disabled]="isCreating">
                        Cancelar
                    </button>
                    <button type="submit" class="btn-submit" [disabled]="isCreating || !newFII.ticker || !newFII.name">
                        {{ isCreating ? 'Criando...' : 'Criar FII' }}
                    </button>
                </div>
            </form>
        </div>
    </div>
    }

    <div class="filters">
        <div class="filter-group">
            <label>Buscar Ticker:</label>
            <input type="text" [(ngModel)]="searchTicker" (input)="applyFilters()" placeholder="Ex: HGLG11" />
        </div>

        <div class="filter-group">
            <label>Segmento:</label>
            <input type="text" [(ngModel)]="filterSegment" (input)="applyFilters()" placeholder="Ex: Tijolo, Papel" />
        </div>

        <button class="reset-btn" (click)="resetFilters()">Limpar Filtros</button>
    </div>

    @if (isLoading) {
    <div class="loading">Carregando FIIs...</div>
    } @else {
    <div class="table-container">
        <table class="fii-table">
            <thead>
                <tr>
                    <th>Ticker</th>
                    <th>Segmento</th>
                    <th>Público Alvo</th>
                    <th>Administrador</th>
                    <th>Último Rend. (R$)</th>
                    <th>DY (%)</th>
                    <th>Data Base</th>
                    <th>Data Pagamento</th>
                    <th>Rend. Méd. 12m (R$)</th>
                    <th>Rend. Méd. 12m (%)</th>
                    <th>Patrimônio/Cota</th>
                    <th>Cotação/VP</th>
                    <th>Nº Negócios/Mês</th>
                    <th>Partic. IFIX (%)</th>
                    <th>Nº Cotistas</th>
                    <th>Patrimônio</th>
                    <th>Cota Base</th>
                </tr>
            </thead>
            <tbody>
                @for (fii of paginatedFIIs; track fii.ticker) {
                <tr>
                    <td class="ticker">{{ fii.ticker }}</td>
                    <td>{{ fii.segment || '-' }}</td>
                    <td>{{ fii.target_audience || '-' }}</td>
                    <td class="admin">{{ fii.administrator || '-' }}</td>
                    <td class="number">{{ fii.last_yield ? formatCurrency(fii.last_yield) : '-' }}</td>
                    <td class="number">{{ formatPercentage(fii.dividend_yield) }}</td>
                    <td>{{ fii.base_date || '-' }}</td>
                    <td>{{ fii.payment_date || '-' }}</td>
                    <td class="number">{{ fii.average_yield_12m_value ? formatCurrency(fii.average_yield_12m_value) :
                        '-' }}</td>
                    <td class="number">{{ formatPercentage(fii.average_yield_12m_percentage) }}</td>
                    <td class="number">{{ fii.equity_per_share ? formatCurrency(fii.equity_per_share) : '-' }}</td>
                    <td class="number">{{ formatNumber(fii.price_to_vp) }}</td>
                    <td class="number">{{ fii.trades_per_month || '-' }}</td>
                    <td class="number">{{ formatPercentage(fii.ifix_participation) }}</td>
                    <td class="number">{{ fii.shareholders_count || '-' }}</td>
                    <td class="number">{{ fii.equity ? formatCurrency(fii.equity) : '-' }}</td>
                    <td class="number">{{ fii.base_share_price ? formatCurrency(fii.base_share_price) : '-' }}</td>
                </tr>
                }
                @if (paginatedFIIs.length === 0) {
                <tr>
                    <td colspan="17" class="no-data">Nenhum FII encontrado.</td>
                </tr>
                }
            </tbody>
        </table>
    </div>

    @if (totalPages > 1) {
    <div class="pagination">
        <button class="page-btn" (click)="previousPage()" [disabled]="currentPage === 1">
            Anterior
        </button>
        <span class="page-info">
            Página {{ currentPage }} de {{ totalPages }}
        </span>
        <button class="page-btn" (click)="nextPage()" [disabled]="currentPage === totalPages">
            Próxima
        </button>
    </div>
    }
    }
</div>